#include "msp430f5529.h"

unsigned char i = 0;
unsigned char j = 0;
unsigned char k = 0;
unsigned char flag = 0;
unsigned int count = 0;
unsigned char disp = 0;
unsigned char disp2 = 0;
unsigned char pov[2][141]= {
  {0x00,0x35,0x01,0x31,0x05,0x05,0x05,0x31,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x21,0x11,0x11,0x21,0x11,0x11,0x21,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x31,0x05,0x05,0x05,0x31,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x21,0x11,0x01,0x21,0x11,0x11,0x21,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01},//for p2
  {0x00,0x3c,0x00,0x20,0x30,0x28,0x24,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0x10,0x00,0x04,0x00,0x10,0x0c,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x24,0x24,0x24,0x1c,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0x10,0x10,0x1c,0x10,0x10,0x0c,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00} //for p1
	};
unsigned char point[2][84]= {
  {0x00,0x1f,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
  {0x00,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}
};
unsigned char word[2][84]= {
  {0x34,0x10,0x20,0x00,0x00,0x00,0x34,0x00,0x20,0x10,0x04,0x04,0x04,0x10,0x00,0x00,0x00,0x34,0x04,0x20,0x10,0x04,0x00,0x00,0x34,0x00,0x00,0x00,0x00,0x00,0x34,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x20,0x10,0x04,0x04,0x04,0x10,0x00,0x00,0x00,0x30,0x04,0x04,0x04,0x10,0x00,0x00,0x00,0x04,0x04,0x34,0x04,0x04,0x00,0x00,0x00,0x34,0x04,0x04,0x04,0x04,0x00},//for p2
  {0x3c,0x00,0x00,0x04,0x08,0x10,0x3c,0x00,0x0c,0x10,0x20,0x20,0x20,0x10,0x00,0x00,0x00,0x3c,0x00,0x08,0x10,0x20,0x00,0x00,0x1c,0x20,0x20,0x20,0x20,0x20,0x1c,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0x10,0x20,0x20,0x20,0x10,0x00,0x00,0x00,0x10,0x24,0x24,0x24,0x18,0x00,0x00,0x00,0x20,0x20,0x3c,0x20,0x20,0x00,0x00,0x00,0x3c,0x24,0x24,0x24,0x20,0x00} //for p1
	}; 

void delay_ms(unsigned int ms )			// MS delay function
{
	unsigned int i;
	for (i = 0; i<= ms; i++)
   	__delay_cycles(5);
}

void main(void)
{
  WDTCTL = WDTPW + WDTHOLD; /* Good dog, no barking */
  
   /* Digital out to a LED */
  P2DIR |= BIT0;
  P2DIR |= BIT2;
  P2DIR |= BIT4;
  P2DIR |= BIT5;
  P1DIR |= BIT2;
  P1DIR |= BIT3;
  P1DIR |= BIT4;
  P1DIR |= BIT5;
  
  P6DIR |= BIT0;
  P6DIR |= BIT1;
  P6DIR |= BIT2;
  P6DIR |= BIT3;
  P6DIR |= BIT4;
  P3DIR |= BIT5;
  P3DIR |= BIT6;
  P2OUT &= 0x00;
  P1OUT &= 0x00;
  P6OUT &= 0x00;
  P3OUT &= 0x00;

  TA1CCTL0 = CCIE;  
  TA1CTL = TASSEL_2 + MC_1 + TACLR + ID_3;
  TA1CCR0 = 20;       //smaller, faster initial=32768
  
  TA0CCTL0 = CCIE;  
  TA0CTL = TASSEL_2 + MC_1 + TACLR + ID_3;
  TA0CCR0 = 512;       //smaller, faster initial=32768 512
 
  __bis_SR_register(GIE); /* Enable maskable interrupts */

  while(1) { /* CPU does nothing and thus no harm */ 
  }
}

#pragma vector=TIMER1_A0_VECTOR
__interrupt void TIMER1_A0_ISR(void)
{
    /*P2OUT ^= BIT0;
    P2OUT ^= BIT2;
    P2OUT ^= BIT4;
    P2OUT ^= BIT5;
    P1OUT ^= BIT2;
    P1OUT ^= BIT3;
    P1OUT ^= BIT4;
    P1OUT ^= BIT5;*/
  
 
  disp^=1;
  if(disp!=0)
  {  
    if(flag==0){
        if(count==40000) flag=1;
	  if(i==141)
             {
		i=0;
              //__delay_cycles(1000);          //delay for backloop 1 sec
             }   
	  P2OUT|=pov[0][i];
          P1OUT|=pov[1][i];
          delay_ms(40);
          i++;
    }   
    else{
      if(count==44000){ 
              flag = 0;
              count = 0;
      }
            if(j==84)
            {
              j=0;
              //__delay_cycles(1000);          //delay for backloop 1 sec
            }   
            P2OUT|=word[0][j];
            P1OUT|=word[1][j];
            delay_ms(100);
            j++;
    }
          count++;
  }
  else
  {
	P2OUT&=0x00;
        P1OUT&=0x00;
        //P3OUT&=0x00;
        //P6OUT&=0x00;
  }

}

#pragma vector=TIMER0_A0_VECTOR
__interrupt void TIMER0_A0_ISR(void)
{
  disp2^=1;
  if(disp2!=0&&flag==0)
  {  
	  if(k==84)
             {
		k=0;
              //__delay_cycles(1000);          //delay for backloop 1 sec
             }   
	  P6OUT|=point[0][k];
          P3OUT|=point[1][k];
          //delay_ms(1000);
	  k++;
  }
  else
  {
	P6OUT&=0x00;
        P3OUT&=0x00;
  }
}

/*https://e2e.ti.com/support/microcontrollers/msp430/f/166/t/297841*/